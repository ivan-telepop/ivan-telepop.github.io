---
title: "Две системы рядом - Установка второй операционки, на MacBook Pro из Ubuntu. "
publishedAt: "2025-11-17"
summary: "Админские будни"
tags: "macbook, linux, SSD, partitioning"
image: "/photos/macbook.jpg"
---






Обзор шагов

Проверить текущую разметку и названия устройств.

Подготовить Live-USB Ubuntu (или GParted Live) и загрузиться с него (нужно, т.к. корневой раздел нельзя безопасно уменьшать, когда он смонтирован).

В Live-сессии проверить и привести в порядок файловую систему ext4 (e2fsck).

Уменьшить файловую систему ext4 (resize2fs) на 200 GiB свободного места.

Изменить таблицу разделов — уменьшить раздел Ubuntu и создать новый GUID-раздел ~200 GiB для macOS (оставить тип под HFS+ / Apple).

Подготовить установочную USB-флешку с macOS Yosemite (нужно иметь легально полученный .dmg/.iso установщика). Балена Этчер можно использовать для записи.

Загрузиться с macOS-USB на MacBook, в Disk Utility отформатировать новый раздел в «Mac OS Extended (Journaled)» с GUID Partition Map и установить Yosemite.

После установки macOS — восстановить/переустановить загрузчик Ubuntu (GRUB/efiboot) при необходимости (через Live Ubuntu).

Дальше — команды + пояснения. Заменяйте /dev/sda на устройство вашего SSD если оно другое (проверьте lsblk).

0. Нужное и предупреждения

Работать из Live-USB Ubuntu (или GParted Live).

Нужен образ macOS Yosemite (DMG/ISO) — я не даю ссылки; получите легально.

Балена Etcher GUI на Ubuntu удобно использовать для записи образа в USB.

Выполняйте команды аккуратно — перепроверьте устройство (/dev/sda, номера разделов).

Любые операции с диском — риск потери данных. Резервная копия обязательна.

1. Подготовка: определение диска и разметки

Загрузитесь в вашу текущую Ubuntu (до шага изменения) или в Live USB — сначала определим, где диск и разделы.

# показать блочные устройства, файловые системы и точки монтирования
sudo lsblk -o NAME,FSTYPE,SIZE,MOUNTPOINT,LABEL

# подробная информация (GPT/MBR, таблица разделов)
sudo parted -l

# или с gdisk
sudo gdisk -l /dev/sda


Назначение: узнать точное имя SSD (например /dev/sda или /dev/nvme0n1) и номер раздела с Ubuntu (например /dev/sda2).

2. Резервная копия (сильно рекомендую)

Простой пример копирования домашней папки на внешний диск /mnt/backup:

# смонтируйте внешний диск в /mnt/backup, затем:
sudo rsync -aHAXv --progress /home/ /mnt/backup/home-backup/


Назначение: при ошибке можно восстановить важные файлы.

3. Перезагрузка в Live USB

Создайте Live-USB Ubuntu (если у вас его нет) и загрузитесь с него. (Если уже используете Live — шаг пропустить.)

В Live-сессии откройте терминал.

4. Проверка и исправление ext4 перед сжатием

Надо отмонитровать раздел и проверить его и только потом уменьшать.

Предположим Ubuntu находится на /dev/sda2. Подставьте своё.

# убедиться, что раздел отмонтирован
sudo umount /dev/sda2 || true

# проверить файловую систему (обязательно)
sudo e2fsck -f /dev/sda2


Назначение: e2fsck исправит ошибки, иначе resize2fs может отказать.

5. Решить на какой размер уменьшать (пример)

У вас SSD 500 GB, нужно выделить 200 GB под macOS → оставляем для Ubuntu 300 GB (пример).
Лучше смотреть реальные значения в GiB; в командах ниже используем GiB.

Допустим сейчас /dev/sda2 занимает весь диск; мы уменьшаем файловую систему до 300G.

# уменьшить файловую систему ext4 до 300G
sudo resize2fs /dev/sda2 300G


Пояснение: resize2fs уменьшает саму файловую систему. Размер указывается меньше чем текущий объём (убедитесь, что данные реально вмещаются в 300G). Если у вас меньше данных, можно задать даже 250G. Можно предварительно проверить занятость df -h в обычной сессии.

Если resize2fs завершил успешно — дальше меняем границы раздела.

6. Изменение таблицы разделов: уменьшение раздела и создание нового

Здесь два варианта: GUI (GParted) или CLI (parted/gdisk). GUI проще и безопаснее — рекомендую открыть GParted в Live-сессии и перетащить правую границу корневого раздела, затем применить, затем создать новый раздел в освободившемся пространстве. Если предпочитаете CLI — пример ниже.

Через GParted (рекомендуется):

В Live-сессии sudo apt update && sudo apt install gparted (если нужно) и запустите gparted из меню.

Выберите /dev/sda, правой кнопкой по ext4 разделе → Resize/Move → введите новый размер (300GiB), Apply.

В свободном месте создайте новый раздел: unallocated → New → файловая система можно выбрать unformatted или hfs+ (в Linux может не быть поддержки — можно создать как "unformatted" и оставить для форматирования macOS). Убедитесь, что таблица разделов — gpt (GUID).

Через CLI (пример):

Узнать номера:

sudo parted /dev/sda unit GiB print


Предположим корневой раздел — номер 2. Узнаем его начало (Start). Например Start = 1.00GiB. Тогда планируем новый конец = start + 300GiB.

# уменьшить границу раздела 2 до 301GiB (пример)
sudo parted /dev/sda --script resizepart 2 301GiB


Важно: parted resizepart меняет границу раздела, но перед этим нужно уменьшить файловую систему (мы сделали resize2fs). Если parted жалуется — используйте GParted GUI.

Создать новый раздел в оставшемся пространстве:

# создать новый partition (number 3) occupying remaining space
sudo parted /dev/sda --script mkpart primary 301GiB 501GiB


Установить тип GUID для Apple HFS (через gdisk):

sudo gdisk /dev/sda
# в интерактивном режиме:
# o/enter? (нет) — используйте 't' чтобы поменять тип нового раздела (например номер 3)
# введите номер раздела (3)
# введите код 'AF00'  # Apple HFS/HFS+
# затем 'w' чтобы записать изменения и выйти


Пояснение: macOS ожидает GUID Partition Table и раздел с типом Apple HFS. Но вы можете оставить новый раздел как «неформатированный» — затем в macOS Disk Utility отформатировать в Mac OS Extended (Journaled).

7. Подготовка установочной USB-флешки с macOS Yosemite

Нужен рабочий образ Install OS X Yosemite.app или его DMG/ISO. На Linux возможны два варианта:

(A) Самый простой — использовать Balena Etcher GUI

В Ubuntu запустите Balena Etcher.

Выберите macOS-образ (.dmg/.iso) как Source, выберите целевую USB-флешку (8+ GB) и нажмите Flash.

После записи USB будет загрузочным (EFI).

(B) Альтернатива — конвертация DMG → IMG и dd (опасно, только если понимаете):
(пример, если есть dmg)

# установить инструмент для преобразования
sudo apt install dmg2img

# конвертировать .dmg в .img
dmg2img /path/to/Yosemite.dmg /tmp/yosemite.img

# записать на USB (замените /dev/sdb на УЗНАННОЕ устройство)
sudo dd if=/tmp/yosemite.img of=/dev/sdb bs=4M status=progress conv=sync
sync


Пояснение/предупреждение: dd перезапишет выбранное устройство — убедитесь, что это флешка, а не ваш SSD. Balena Etcher безопаснее для большинства пользователей.

8. Установка macOS на созданный раздел

Вставьте macOS USB и перезагрузите MacBook, удерживая клавишу Option (Alt) при старте.

Выберите USB-установщик.

В Disk Utility: выберите ваш новый 200GB раздел → Erase → Format: Mac OS Extended (Journaled), Scheme: GUID Partition Map. Нажмите Erase.

Запустите установку Yosemite и выберите этот отформатированный раздел как целевой.

Пояснение: Yosemite использует HFS+ (Mac OS Extended), не APFS. Если инсталлятор не видит раздел — проверьте схему GPT и что раздел помечен Apple.

9. После установки macOS — проверка загрузчика и восстановление Ubuntu (если нужно)

Установка macOS может изменить порядок загрузки EFI и/или перезаписать загрузчик. Если после установки вы не видите Ubuntu в списке загрузки — восстановите GRUB.

Загрузитесь с Live-USB Ubuntu и выполните:

# смонтируйте корень вашей Ubuntu (предположим /dev/sda2) и EFI (предположим /dev/sda1)
sudo mount /dev/sda2 /mnt
sudo mount /dev/sda1 /mnt/boot/efi   # если /boot/efi в вашей системе именно там

# привязать необходимые точки
for i in /dev /dev/pts /proc /sys /run; do sudo mount --bind $i /mnt$i; done

# chroot
sudo chroot /mnt

# внутри chroot (как root) переустановите grub-efi
grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=ubuntu
update-grub

# выйти из chroot
exit

# размонтировать
for i in /run /sys /proc /dev/pts /dev; do sudo umount /mnt$i; done
sudo umount /mnt/boot/efi
sudo umount /mnt


После этого при старте Mac удерживайте Option — в списке должен появиться «ubuntu» или «GRUB», и macOS.

Альтернатива: установить rEFInd (удобный EFI-менеджер) из macOS для выбора между macOS и Ubuntu.

Полезные команды для проверки в любой момент
# текущее использование диска
df -h

# разделы и типы
sudo lsblk -o NAME,SIZE,TYPE,FSTYPE,MOUNTPOINT

# GPT таблица
sudo parted /dev/sda print

# загрузочные записи EFI
sudo efibootmgr -v

Частые проблемы и заметки

Нельзя уменьшать смонтированный корень. Поэтому Live-USB обязательно.

Если данных больше чем 300 GB — уменьшить до 300G нельзя; установите размер в соответствии с фактическим занятым местом плюс запас.

macOS-образ: проще готовить установщик на Mac (через createinstallmedia), но можно и с Linux (Balena Etcher).

APFS vs HFS+: Yosemite использует HFS+. Новые APFS появились позже. Форматируйте в Disk Utility при установке.

EFI/GRUB: после установки macOS загрузчик Ubuntu может потребовать восстановления — шаг 9.